#!/usr/bin/env node

!function(e){function t(n){if(r[n])return r[n].exports;var u=r[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,t),u.l=!0,u.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(e,t){e.exports=require("fs")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(3),a=(n(u),r(16));n(a);t["default"]={filepath:process.env.NODE_HIDE_FILEPATH||"~",filename:process.env.NODE_HIDE_FILENAME||"__node-hide-accounts",cryptography:{algorithm:process.env.CRYPT_ALGORITHM||"aes-256-ctr",password:process.env.CRYPT_SECRET}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function u(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(u,a){try{var i=t[u](a),o=i.value}catch(c){return void r(c)}return i.done?void e(o):Promise.resolve(o).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(11),i=(n(a),r(0)),o=n(i),c=r(3),s=n(c),f=r(4),l=n(f),d=r(12),p=n(d),h=r(1),m=n(h),v=(0,l["default"])(o["default"].mkdir),x=(0,l["default"])(o["default"].writeFile),b=(0,l["default"])(o["default"].readFile),y=(0,p["default"])();t["default"]={filepath:s["default"].join(m["default"].filepath,m["default"].filename),getAndDecryptFlatFile:function(){function e(){return t.apply(this,arguments)}var t=u(regeneratorRuntime.mark(function r(){var e,t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!this.doesDirectoryExist(m["default"].filepath)){r.next=25;break}if(!this.doesFileExist(this.filepath)){r.next=22;break}return r.next=4,b(this.filepath);case 4:if(e=r.sent,0!==e.length){r.next=9;break}return r.abrupt("return",null);case 9:return r.next=11,y.parseData(e.toString("utf8"),!1);case 11:return t=r.sent,r.prev=12,n=JSON.parse(y.decrypt(t.toString("utf8"))),r.abrupt("return",n);case 17:throw r.prev=17,r.t0=r["catch"](12),("We're having a problem parsing your flat file at '"+this.filepath+"'.\n              This is likely due to a different master password, environment variable CRYPT_SECRET,\n              being used that previously was set. Make sure you have the correct\n              secret you used before and try again.").replace(/\n\s+/g,"\n");case 20:r.next=25;break;case 22:return r.next=24,x(this.filepath,"");case 24:return r.abrupt("return",null);case 25:return r.next=27,v(m["default"].filepath);case 27:return r.next=29,x(this.filepath,"");case 29:return r.abrupt("return","");case 30:case"end":return r.stop()}},r,this,[[12,17]])}));return e}(),writeObjToFile:function(){function e(e){return t.apply(this,arguments)}var t=u(regeneratorRuntime.mark(function r(e){var t,n,u,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=Object.assign(a,e),n=y.encrypt(JSON.stringify(t)),r.next=4,y.parseData(n);case 4:return u=r.sent,r.next=7,x(this.filepath,u);case 7:return r.abrupt("return",r.sent);case 8:case"end":return r.stop()}},r,this)}));return e}(),doesDirectoryExist:function(e){try{var t=o["default"].statSync(e).isDirectory();return t}catch(r){return!1}},doesFileExist:function(e){try{var t=o["default"].statSync(e).isFile();return t}catch(r){return!1}}}},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("es6-promisify")},function(e,t,r){r(6),e.exports=r(7)},function(e,t){e.exports=require("babel-polyfill")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function u(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(u,a){try{var i=t[u](a),o=i.value}catch(c){return void r(c)}return i.done?void e(o):Promise.resolve(o).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}var a=function(){function e(e,t){var r=[],n=!0,u=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(c){u=!0,a=c}finally{try{!n&&o["return"]&&o["return"]()}finally{if(u)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=r(8),o=n(i),c=r(9),s=n(c),f=r(2),l=n(f),d=r(17),p=n(d),h=r(19),m=n(h),v=r(1),x=n(v),b=(0,o["default"])(process.argv.slice(2)),y=a(b._,1),g=y[0];x["default"].cryptography.password||(m["default"].noCryptSecret(),process.exit()),u(regeneratorRuntime.mark(function w(){var e,t,r,n,u,a,i,o,c,f,d,h,v,x,y,k;return regeneratorRuntime.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:w.prev=0,e=b.e||b.extra,t=b.n||b.name,r=b.p||b.password,n=b.i||b.id||b.uuid,u=b.u||b.username,w.t0=g,w.next="add"===w.t0?9:"delete"===w.t0?15:"search"===w.t0?22:"show"===w.t0?28:"update"===w.t0?44:"import"===w.t0?72:90;break;case 9:if(t){w.next=11;break}return w.abrupt("return",m["default"].error("An account name (-n or --name) parameter is a required at a minimum to add a new account."));case 11:return w.next=13,s["default"].addAccount(t,u,r,e);case 13:return m["default"].success("Successfully added account '"+t+"'!"),w.abrupt("break",91);case 15:if(n){w.next=17;break}return w.abrupt("return",m["default"].error("A uuid (-u or --uuid) is a required to delete an account."));case 17:return w.next=19,s["default"].deleteAccountByUuid(n);case 19:return a=w.sent,a?m["default"].success("Successfully deleted account with uuid: '"+n+"'"):m["default"].error("We didn't find an account with uuid: '"+n+"'"),w.abrupt("break",91);case 22:return i=b.s||b.search,w.next=25,s["default"].searchForAccountsByName(i);case 25:return o=w.sent,m["default"].listAccounts(o.matches,o.total),w.abrupt("break",91);case 28:if(!n){w.next=35;break}return w.next=31,s["default"].findAccountByUuid(n);case 31:c=w.sent,c?(r||delete c.password,m["default"].listSingleAccount(c)):m["default"].error("We didn't find an account with uuid: "+n),w.next=43;break;case 35:if(!t){w.next=42;break}return w.next=38,s["default"].findAccountByName(t);case 38:f=w.sent,f?(r||delete f.password,m["default"].listSingleAccount(f)):m["default"].error("We didn't find an account with name: "+t),w.next=43;break;case 42:m["default"].error("Either a name (-n or --name) or uuid (-u or --uuid) parameter is a required at a minimum to show the details for an account.");case 43:return w.abrupt("break",91);case 44:if(!n){w.next=57;break}return w.next=47,s["default"].findAccountByUuid(n);case 47:if(d=w.sent,!d){w.next=54;break}return w.next=51,s["default"].updateAccount(n,{name:t,username:u,password:r,extra:e},d);case 51:m["default"].success("Successfully updated account with uuid: '"+n+"'!"),w.next=55;break;case 54:m["default"].error("We didn't find an account with uuid: "+n);case 55:w.next=71;break;case 57:if(!t){w.next=70;break}return w.next=60,s["default"].findAccountByName(t);case 60:if(h=w.sent,!h){w.next=67;break}return w.next=64,s["default"].updateAccount(h.uuid,{name:t,username:u,password:r,extra:e},h);case 64:m["default"].success("Successfully updated account with name: '"+t+"'!"),w.next=68;break;case 67:m["default"].error("We didn't find an account with name: "+t);case 68:w.next=71;break;case 70:m["default"].error("Either a name (-n or --name) or uuid (-u or --uuid) parameter is a required at a minimum to show the details for an account.");case 71:return w.abrupt("break",91);case 72:if(v=b.f||b.filepath,!l["default"].doesFileExist(v)){w.next=88;break}return w.next=76,p["default"].csv(v);case 76:x=w.sent,y=x.length;case 78:if(!(x.length>0)){w.next=85;break}if(k=x.shift(),!k.name){w.next=83;break}return w.next=83,s["default"].addAccount(k.name,k.username,k.password,k.extra);case 83:w.next=78;break;case 85:m["default"].success("Successfully added "+y+" accounts from CSV: "+v+"!"),w.next=89;break;case 88:m["default"].error("We can't find filepath provided: "+v);case 89:return w.abrupt("break",91);case 90:m["default"].error("I don't recognize what you are trying to do.\nPlease refer to the documentation for what commands I support.");case 91:process.exit(),w.next=98;break;case 94:w.prev=94,w.t1=w["catch"](0),"string"==typeof w.t1?m["default"].error(w.t1):console.error(w.t1),process.exit();case 98:case"end":return w.stop()}},w,void 0,[[0,94]])}))()},function(e,t){e.exports=require("minimist")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(u,a){try{var i=t[u](a),o=i.value}catch(c){return void r(c)}return i.done?void e(o):Promise.resolve(o).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(10),o=n(i),c=r(2),s=n(c);t["default"]={createUuid:function(){return(0,o["default"])()},addAccount:function(){function e(e,r,n){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function r(e,t,n){var a,i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a=u({},this.createUuid(),{name:e,username:t||"",password:n||"",extra:o||""}),r.next=3,s["default"].getAndDecryptFlatFile();case 3:return i=r.sent,r.next=6,s["default"].writeObjToFile(a,i||{});case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}},r,this)}));return e}(),updateAccount:function(){function e(e){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function r(e){var t,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=u({},e,{name:a.name||i.name||"",username:a.username||i.username||"",password:a.password||i.password||"",extra:a.extra||i.extra||""}),r.next=3,s["default"].getAndDecryptFlatFile();case 3:return n=r.sent,r.next=6,s["default"].writeObjToFile(t,n||{});case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}},r,this)}));return e}(),deleteAccountByUuid:function(){function e(e){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function r(e){var t;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,s["default"].getAndDecryptFlatFile();case 2:if(t=r.sent,t&&t[e]){r.next=5;break}return r.abrupt("return",!1);case 5:return delete t[e],r.next=8,s["default"].writeObjToFile({},t);case 8:return r.abrupt("return",!0);case 9:case"end":return r.stop()}},r,this)}));return e}(),findAccountByUuid:function(){function e(e){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function r(e){var t;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,s["default"].getAndDecryptFlatFile();case 2:if(t=r.sent,t&&t[e]){r.next=5;break}return r.abrupt("return",!1);case 5:return r.abrupt("return",Object.assign(t[e],{uuid:e}));case 6:case"end":return r.stop()}},r,this)}));return e}(),findAccountByName:function(){function e(e){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function r(e){var t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,s["default"].getAndDecryptFlatFile();case 2:if(t=r.sent){r.next=5;break}return r.abrupt("return",!1);case 5:if(n=Object.keys(t).filter(function(r){return t[r].name.toLowerCase()==e.toLowerCase()})[0]){r.next=8;break}return r.abrupt("return",!1);case 8:return r.abrupt("return",Object.assign(t[n],{uuid:n}));case 9:case"end":return r.stop()}},r,this)}));return e}(),searchForAccountsByName:function(){function e(){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function r(){var e,t,n,u,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,s["default"].getAndDecryptFlatFile();case 2:if(e=r.sent){r.next=5;break}return r.abrupt("return",{matches:[],total:0});case 5:return t=Object.keys(e),n=t.length,u=t.map(function(t){var r=e[t];if(!r)return null;if(a){var n=new RegExp(a,"i"),u=r.name&&n.test(r.name),i=r.username&&n.test(r.username);return u||i?Object.assign(r,{uuid:t}):null}return Object.assign(r,{uuid:t})}).filter(function(e){return!!e}),r.abrupt("return",{matches:u,total:n});case 9:case"end":return r.stop()}},r,this)}));return e}(),searchForAccountsByUsername:function(e){}}},function(e,t){e.exports=require("uuid/v4")},function(e,t){e.exports=require("util")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function u(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(u,a){try{var i=t[u](a),o=i.value}catch(c){return void r(c)}return i.done?void e(o):Promise.resolve(o).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{_algorithm:e.algorithm||x["default"].cryptography.algorithm,_secret:e.secret||x["default"].cryptography.password,encrypt:function(e){var t=o["default"].createCipher(this._algorithm,this._secret),r=t.update(e,"utf8","hex");return r+=t["final"]("hex")},decrypt:function(e){var t=o["default"].createDecipher(this._algorithm,this._secret),r=t.update(e,"hex","utf8");return r+=t["final"]("utf8")},stringToHash:function(e){var t=o["default"].createHash("md5");return t.update(e),t.digest("hex")},fileToHash:function(e){return new Promise(function(t,r){var n=o["default"].createHash("md5"),u=s["default"].ReadStream(e);u.on("data",function(e){return n.update(e)}),u.on("error",r),u.on("end",function(){return t(n.digest("hex"))})})},hashPassword:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return p["default"].hash(e,t)},comparePassword:function(e,t){return p["default"].compare(e,t)},parseData:function(){function e(e){return t.apply(this,arguments)}var t=u(regeneratorRuntime.mark(function r(e){var t,n,u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t=void 0,r.t0=u,r.next=r.t0===!1?4:7;break;case 4:return r.next=6,b(new Buffer(e,"base64"));case 6:return r.abrupt("return",r.sent);case 7:return r.next=9,y(e);case 9:return n=r.sent,r.abrupt("return",new Buffer(n).toString("base64"));case 11:case"end":return r.stop()}},r,this)}));return e}()}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a;var i=r(13),o=n(i),c=r(0),s=n(c),f=r(14),l=n(f),d=r(15),p=n(d),h=r(4),m=n(h),v=r(1),x=n(v),b=(0,m["default"])(l["default"].inflate),y=(0,m["default"])(l["default"].deflate)},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("zlib")},function(e,t){e.exports=require("bcrypt")},function(e,t){e.exports=require("app-root-path")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(0),a=n(u),i=r(18),o=n(i);t["default"]={csv:function(e){return new Promise(function(t,r){var n=o["default"].parse({columns:!0},function(e,n){return e?r(e):void t(n)});a["default"].createReadStream(e).pipe(n)})}}},function(e,t){e.exports=require("csv")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(20),a=(n(u),r(21)),i=n(a),o=function(){};t["default"]={noCryptSecret:function(){this.wrapInNewlines(function(){console.log("You don't have environment variable CRYPT_SECRET set.".red),console.log(">export CRYPT_SECRET=[your all time master secret value]".green)})},listSingleAccount:function(e){var t=this;this.wrapInNewlines(function(){return console.log(t.columnify([e]).green)})},listAccounts:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t.map(function(e){return"string"==typeof e?{name:e}:(delete e.password,e)});this.wrapInNewlines(function(){console.log("I found the following accounts:".blue),console.log(e.columnify(n).green),console.log((t.length+" of "+r+" total accounts returned").blue)})},success:function(e){this.wrapInNewlines(function(){return console.log(e.green)})},error:function(e){this.wrapInNewlines(function(){return console.log(e.red)})},wrapInNewlines:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=new Array(t-1).fill("\n").join("");t>0&&console.log(r),e(),t>0&&console.log(r)},columnify:function(e){return(0,i["default"])(e,{minWidth:15})}}},function(e,t){e.exports=require("colors")},function(e,t){e.exports=require("columnify")}]);