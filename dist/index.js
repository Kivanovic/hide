#!/usr/bin/env node

!function(e){function t(n){if(r[n])return r[n].exports;var u=r[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,t),u.l=!0,u.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t){e.exports=require("fs")},function(e,t,r){"use strict";function n(){return process.env["win32"==process.platform?"USERPROFILE":"HOME"]}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={filepath:process.env.NODE_HIDE_FILEPATH||n(),filename:process.env.NODE_HIDE_FILENAME||"__node-hide-accounts",cryptography:{algorithm:process.env.CRYPT_ALGORITHM||"aes-256-ctr",password:process.env.CRYPT_SECRET}}},function(e,t){e.exports=require("path")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function u(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(u,a){try{var i=t[u](a),o=i.value}catch(c){return void r(c)}return i.done?void e(o):Promise.resolve(o).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),i=n(a),o=r(2),c=n(o),s=r(4),f=n(s),l=r(5),d=n(l),p=r(1),h=n(p),m=(0,f["default"])(i["default"].mkdir),v=(0,f["default"])(i["default"].writeFile),x=(0,f["default"])(i["default"].readFile),b=(0,d["default"])();t["default"]={filepath:c["default"].join(h["default"].filepath,h["default"].filename),getAndDecryptFlatFile:function(){function e(){return t.apply(this,arguments)}var t=u(regeneratorRuntime.mark(function r(){var e,t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!this.doesDirectoryExist(h["default"].filepath)){r.next=25;break}if(!this.doesFileExist(this.filepath)){r.next=22;break}return r.next=4,x(this.filepath);case 4:if(e=r.sent,0!==e.length){r.next=9;break}return r.abrupt("return",null);case 9:return r.next=11,b.parseData(e.toString("utf8"),!1);case 11:return t=r.sent,r.prev=12,n=JSON.parse(b.decrypt(t.toString("utf8"))),r.abrupt("return",n);case 17:throw r.prev=17,r.t0=r["catch"](12),("We're having a problem parsing your flat file at '"+this.filepath+"'.\n              This is likely due to a different master password, environment variable CRYPT_SECRET,\n              being used that previously was set. Make sure you have the correct\n              secret you used before and try again.").replace(/\n\s+/g,"\n");case 20:r.next=25;break;case 22:return r.next=24,v(this.filepath,"");case 24:return r.abrupt("return",null);case 25:return r.next=27,m(h["default"].filepath);case 27:return r.next=29,v(this.filepath,"");case 29:return r.abrupt("return","");case 30:case"end":return r.stop()}},r,this,[[12,17]])}));return e}(),writeObjToFile:function(){function e(e){return t.apply(this,arguments)}var t=u(regeneratorRuntime.mark(function r(e){var t,n,u,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=Object.assign(a,e),n=b.encrypt(JSON.stringify(t)),r.next=4,b.parseData(n);case 4:return u=r.sent,r.next=7,v(this.filepath,u);case 7:return r.abrupt("return",r.sent);case 8:case"end":return r.stop()}},r,this)}));return e}(),doesDirectoryExist:function(e){try{var t=i["default"].statSync(e).isDirectory();return t}catch(r){return!1}},doesFileExist:function(e){try{var t=i["default"].statSync(e).isFile();return t}catch(r){return!1}}}},function(e,t){e.exports=require("es6-promisify")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function u(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(u,a){try{var i=t[u](a),o=i.value}catch(c){return void r(c)}return i.done?void e(o):Promise.resolve(o).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{_algorithm:e.algorithm||m["default"].cryptography.algorithm,_secret:e.secret||m["default"].cryptography.password,encrypt:function(e){var t=o["default"].createCipher(this._algorithm,this._secret),r=t.update(e,"utf8","hex");return r+=t["final"]("hex")},encryptFileUtf8:function(){function e(e){return t.apply(this,arguments)}var t=u(regeneratorRuntime.mark(function r(e){var t;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("filePath",e),r.next=3,v(e,{encoding:"utf8"});case 3:return t=r.sent,r.abrupt("return",this.encrypt(t));case 5:case"end":return r.stop()}},r,this)}));return e}(),decrypt:function(e){var t=o["default"].createDecipher(this._algorithm,this._secret),r=t.update(e,"hex","utf8");return r+=t["final"]("utf8")},decryptFileUtf8:function(){function e(e){return t.apply(this,arguments)}var t=u(regeneratorRuntime.mark(function r(e){var t;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,v(e,{encoding:"utf8"});case 2:return t=r.sent,r.abrupt("return",this.decrypt(t));case 4:case"end":return r.stop()}},r,this)}));return e}(),stringToHash:function(e){var t=o["default"].createHash("md5");return t.update(e),t.digest("hex")},fileToHash:function(e){return new Promise(function(t,r){var n=o["default"].createHash("md5"),u=s["default"].ReadStream(e);u.on("data",function(e){return n.update(e)}),u.on("error",r),u.on("end",function(){return t(n.digest("hex"))})})},parseData:function(){function e(e){return t.apply(this,arguments)}var t=u(regeneratorRuntime.mark(function r(e){var t,n,u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t=void 0,r.t0=u,r.next=r.t0===!1?4:7;break;case 4:return r.next=6,x(new Buffer(e,"base64"));case 6:return r.abrupt("return",r.sent);case 7:return r.next=9,b(e);case 9:return n=r.sent,r.abrupt("return",new Buffer(n).toString("base64"));case 11:case"end":return r.stop()}},r,this)}));return e}()}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a;var i=r(12),o=n(i),c=r(0),s=n(c),f=r(13),l=n(f),d=r(4),p=n(d),h=r(1),m=n(h),v=(0,p["default"])(s["default"].readFile),x=(0,p["default"])(l["default"].inflate),b=(0,p["default"])(l["default"].deflate)},function(e,t,r){r(7),e.exports=r(8)},function(e,t){e.exports=require("babel-polyfill")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function u(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(u,a){try{var i=t[u](a),o=i.value}catch(c){return void r(c)}return i.done?void e(o):Promise.resolve(o).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}var a=function(){function e(e,t){var r=[],n=!0,u=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(c){u=!0,a=c}finally{try{!n&&o["return"]&&o["return"]()}finally{if(u)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=r(9),o=n(i),c=r(2),s=n(c),f=r(10),l=n(f),d=r(5),p=n(d),h=r(3),m=n(h),v=r(14),x=n(v),b=r(16),g=n(b),y=r(1),w=n(y),k=(0,o["default"])(process.argv.slice(2)),_=a(k._,3),R=_[0],A=_[1];_[2];w["default"].cryptography.password||(g["default"].noCryptSecret(),process.exit()),u(regeneratorRuntime.mark(function F(){var e,t,r,n,u,a,i,o,c,f,d,h,v,b,y,_,E,P,O,S,T,j,D,C,I,N,M,q,B,U;return regeneratorRuntime.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:F.prev=0,e=k.e||k.extra,t=k.n||k.name,r=k.p||k.password,n=k.i||k.id||k.uuid,u=k.u||k.username,a=k.t||k.text,i=k.f||k.file,o=(0,p["default"])(),F.t0=R,F.next="add"===F.t0?12:"delete"===F.t0?19:"search"===F.t0?28:"show"===F.t0?34:"update"===F.t0?55:"file"===F.t0?77:"import"===F.t0?80:"encrypt"===F.t0?105:"decrypt"===F.t0?121:137;break;case 12:if(c=t||A){F.next=15;break}return F.abrupt("return",g["default"].error("An account name (-n or --name) parameter is a required at a minimum to add a new account."));case 15:return F.next=17,l["default"].addAccount(c,u,r,e);case 17:return g["default"].success("Successfully added account '"+c+"'!"),F.abrupt("break",138);case 19:if(n){F.next=21;break}return F.abrupt("return",g["default"].error("A uuid (-i or --id or --uuid) is a required to delete an account."));case 21:return F.next=23,l["default"].deleteAccountByUuid(n);case 23:if(f=F.sent,!f){F.next=26;break}return F.abrupt("return",g["default"].success("Successfully deleted account with uuid: '"+n+"'"));case 26:return g["default"].error("We didn't find an account with uuid: '"+n+"'"),F.abrupt("break",138);case 28:return d=k.s||k.search||A,F.next=31,l["default"].searchForAccountsByName(d);case 31:return h=F.sent,g["default"].listAccounts(h.matches,h.total),F.abrupt("break",138);case 34:if(!n){F.next=44;break}return F.next=37,l["default"].findAccountByUuid(n);case 37:if(v=F.sent,!v){F.next=41;break}return r||delete v.password,F.abrupt("return",g["default"].listSingleAccount(v));case 41:return F.abrupt("return",g["default"].error("We didn't find an account with uuid: "+n));case 44:if(!t&&!A){F.next=53;break}return b=t||A,F.next=48,l["default"].findAccountByName(b);case 48:if(y=F.sent,!y){F.next=52;break}return r||delete y.password,F.abrupt("return",g["default"].listSingleAccount(y));case 52:return F.abrupt("return",g["default"].error("We didn't find an account with name: "+b));case 53:return g["default"].error("Either a name (-n or --name) or uuid (-i or --id or --uuid) parameter is a required at a minimum to show the details for an account."),F.abrupt("break",138);case 55:if(!n){F.next=66;break}return F.next=58,l["default"].findAccountByUuid(n);case 58:if(_=F.sent,!_){F.next=63;break}return F.next=62,l["default"].updateAccount(n,{name:t,username:u,password:r,extra:e},_);case 62:return F.abrupt("return",g["default"].success("Successfully updated account with uuid: '"+n+"'!"));case 63:return F.abrupt("return",g["default"].error("We didn't find an account with uuid: "+n));case 66:if(!t){F.next=75;break}return F.next=69,l["default"].findAccountByName(t);case 69:if(E=F.sent,!E){F.next=74;break}return F.next=73,l["default"].updateAccount(E.uuid,{name:t,username:u,password:r,extra:e},E);case 73:return F.abrupt("return",g["default"].success("Successfully updated account with name: '"+t+"'!"));case 74:return F.abrupt("return",g["default"].error("We didn't find an account with name: "+t));case 75:return g["default"].error("Either a name (-n or --name) or uuid (-i or --id or --uuid) parameter is a required at a minimum to show the details for an account."),F.abrupt("break",138);case 77:return P=s["default"].join(w["default"].filepath,w["default"].filename),g["default"].twoLinesDifferentColors("Your encrypted file is in the following location:",P,"blue","green"),F.abrupt("break",138);case 80:if(O=k.f||k.filepath||A,!O||!m["default"].doesFileExist(O)){F.next=103;break}return F.next=84,x["default"].csv(O);case 84:S=F.sent,T=0,j=0,D=S.length;case 88:if(!(S.length>0)){F.next=99;break}if(C=S.shift(),!C.name){F.next=96;break}return T++,F.next=94,l["default"].addAccount(C.name,C.username,C.password,C.extra);case 94:F.next=97;break;case 96:j++;case 97:F.next=88;break;case 99:return I="Successfully added "+T+" accounts from CSV: "+O+"!",N=j>0?"Did not add "+j+" accounts because we didn't see an account name ('name' CSV header).":"",g["default"].twoLinesDifferentColors(I,N,"green","red"),F.abrupt("return",g["default"].singleLine("Total number of rows in spreadsheet: "+D+"\n","blue",0));case 103:return g["default"].error("We can't find filepath provided: "+(O||"NO FILE PROVIDED")),F.abrupt("break",138);case 105:if(M=a||A,q=void 0,!M){F.next=112;break}q=o.encrypt(M),g["default"].success(q),F.next=120;break;case 112:if(!i){F.next=119;break}return F.next=115,o.encryptFileUtf8(i);case 115:q=F.sent,g["default"].success(q),F.next=120;break;case 119:g["default"].error("Please enter text (-t or --text) or a file path (-f or --file) to encrypt text.");case 120:return F.abrupt("break",138);case 121:if(B=a||A,U=void 0,!B){F.next=128;break}U=o.decrypt(B),g["default"].success(U),F.next=136;break;case 128:if(!i){F.next=135;break}return F.next=131,o.decryptFileUtf8(i);case 131:U=F.sent,g["default"].success(U),F.next=136;break;case 135:g["default"].error("Please enter text (-t or --text) or a file path (-f or --file) to encrypt text.");case 136:return F.abrupt("break",138);case 137:g["default"].error("I don't recognize what you are trying to do.\nPlease refer to the documentation for what commands I support.");case 138:process.exit(),F.next=145;break;case 141:F.prev=141,F.t1=F["catch"](0),"string"==typeof F.t1?g["default"].error(F.t1):"TypeError: Bad input string"==F.t1.toString()?(g["default"].error("Uh oh, The error we got is '"+F.t1.toString()+"'\n\nThis usually means the CRYPT_SECRET is different for the info you're trying to decrypt than was used to encrypt it. Full stack trace below."),console.log(F.t1)):console.log(F.t1),process.exit();case 145:case"end":return F.stop()}},F,void 0,[[0,141]])}))()},function(e,t){e.exports=require("minimist")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(u,a){try{var i=t[u](a),o=i.value}catch(c){return void r(c)}return i.done?void e(o):Promise.resolve(o).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(11),o=n(i),c=r(3),s=n(c);t["default"]={createUuid:function(){return(0,o["default"])()},addAccount:function(){function e(e,r,n){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function r(e,t,n){var a,i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a=u({},this.createUuid(),{name:e,username:t||"",password:n||"",extra:o||""}),r.next=3,s["default"].getAndDecryptFlatFile();case 3:return i=r.sent,r.next=6,s["default"].writeObjToFile(a,i||{});case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}},r,this)}));return e}(),updateAccount:function(){function e(e){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function r(e){var t,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=u({},e,{name:a.name||i.name||"",username:a.username||i.username||"",password:a.password||i.password||"",extra:a.extra||i.extra||""}),r.next=3,s["default"].getAndDecryptFlatFile();case 3:return n=r.sent,r.next=6,s["default"].writeObjToFile(t,n||{});case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}},r,this)}));return e}(),deleteAccountByUuid:function(){function e(e){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function r(e){var t;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,s["default"].getAndDecryptFlatFile();case 2:if(t=r.sent,t&&t[e]){r.next=5;break}return r.abrupt("return",!1);case 5:return delete t[e],r.next=8,s["default"].writeObjToFile({},t);case 8:return r.abrupt("return",!0);case 9:case"end":return r.stop()}},r,this)}));return e}(),findAccountByUuid:function(){function e(e){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function r(e){var t;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,s["default"].getAndDecryptFlatFile();case 2:if(t=r.sent,t&&t[e]){r.next=5;break}return r.abrupt("return",!1);case 5:return r.abrupt("return",Object.assign(t[e],{uuid:e}));case 6:case"end":return r.stop()}},r,this)}));return e}(),findAccountByName:function(){function e(e){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function r(e){var t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,s["default"].getAndDecryptFlatFile();case 2:if(t=r.sent){r.next=5;break}return r.abrupt("return",!1);case 5:if(n=Object.keys(t).filter(function(r){return t[r].name.toLowerCase()==e.toLowerCase()})[0]){r.next=8;break}return r.abrupt("return",!1);case 8:return r.abrupt("return",Object.assign(t[n],{uuid:n}));case 9:case"end":return r.stop()}},r,this)}));return e}(),searchForAccountsByName:function(){function e(){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function r(){var e,t,n,u,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,s["default"].getAndDecryptFlatFile();case 2:if(e=r.sent){r.next=5;break}return r.abrupt("return",{matches:[],total:0});case 5:return t=Object.keys(e),n=t.length,u=t.map(function(t){var r=e[t];if(!r)return null;if(a){var n=new RegExp(a,"i"),u=r.name&&n.test(r.name),i=r.username&&n.test(r.username);return u||i?Object.assign(r,{uuid:t}):null}return Object.assign(r,{uuid:t})}).filter(function(e){return!!e}),r.abrupt("return",{matches:u,total:n});case 9:case"end":return r.stop()}},r,this)}));return e}(),searchForAccountsByUsername:function(e){}}},function(e,t){e.exports=require("uuid/v4")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("zlib")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(0),a=n(u),i=r(15),o=n(i);t["default"]={csv:function(e){return new Promise(function(t,r){var n=o["default"].parse({columns:!0},function(e,n){return e?r(e):void t(n)});a["default"].createReadStream(e).pipe(n)})}}},function(e,t){e.exports=require("csv")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(17),a=(n(u),r(18)),i=n(a),o=function(){};t["default"]={noCryptSecret:function(){this.wrapInNewlines(function(){console.log("You don't have environment variable CRYPT_SECRET set.".red),console.log(">export CRYPT_SECRET=[your all time master secret value]".green)})},listSingleAccount:function(e){var t=this;this.wrapInNewlines(function(){return console.log(t.columnify([e]).green)})},listAccounts:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t.map(function(e){return"string"==typeof e?{name:e}:(delete e.password,e)});this.wrapInNewlines(function(){console.log("I found the following accounts:".blue),console.log(e.columnify(n).green),console.log((t.length+" of "+r+" total accounts returned").blue)})},twoLinesDifferentColors:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"blue",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"green";this.wrapInNewlines(function(){e.length>0&&console.log(e[r]),t.length>0&&console.log(t[n])})},singleLine:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blue",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.wrapInNewlines(function(){return console.log(e[t])},r)},success:function(e){this.wrapInNewlines(function(){return console.log(e.green)})},error:function(e){this.wrapInNewlines(function(){return console.log(e.red)})},wrapInNewlines:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=t-1>0?new Array(t-1).fill("\n").join(""):"";t>0&&console.log(r),e(),t>0&&console.log(r)},columnify:function(e){return(0,i["default"])(e,{minWidth:15})}}},function(e,t){e.exports=require("colors")},function(e,t){e.exports=require("columnify")}]);